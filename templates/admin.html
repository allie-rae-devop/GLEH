<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Control Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <style>
        [data-bs-theme="dark"] {
            --bs-body-bg: #121212;
            --bs-tertiary-bg: #1a1a1a;
            --bs-border-color: #2a2a2a;
        }

        .nav-tabs .nav-link {
            color: #888;
            border: none;
            border-bottom: 3px solid transparent;
        }

        .nav-tabs .nav-link.active {
            color: #fff;
            border-bottom-color: #0d6efd;
            background-color: transparent;
        }

        .nav-tabs .nav-link:hover {
            color: #ccc;
        }

        .stat-card {
            background: var(--bs-tertiary-bg);
            border: 1px solid var(--bs-border-color);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #0d6efd;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        .progress-log {
            background: #0a0a0a;
            border: 1px solid var(--bs-border-color);
            border-radius: 6px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.85rem;
        }

        .progress-log .log-line {
            margin: 5px 0;
            color: #aaa;
        }

        .progress-log .log-success {
            color: #28a745;
        }

        .progress-log .log-error {
            color: #dc3545;
        }

        .progress-log .log-info {
            color: #17a2b8;
        }

        .btn-action {
            min-width: 150px;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: 500;
        }

        .status-running {
            background-color: #28a745;
            color: white;
        }

        .status-stopped {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>
<body class="bg-body-tertiary">

    <header class="py-3 border-bottom" style="background-color: var(--bs-tertiary-bg);">
        <div class="container d-flex align-items-center">
            <a href="{{ url_for('index') }}" class="text-decoration-none text-body d-flex align-items-center">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="GLEH Logo" style="max-height: 60px; max-width: 100%;">
            </a>
            <h1 class="mb-0 fs-3 ms-3">Admin Control Panel</h1>
        </div>
    </header>

    <main class="container-fluid my-4">
        <!-- Tab Navigation -->
        <ul class="nav nav-tabs mb-4" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">Dashboard</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="textbooks-tab" data-bs-toggle="tab" data-bs-target="#textbooks" type="button" role="tab">Textbooks</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="courses-tab" data-bs-toggle="tab" data-bs-target="#courses" type="button" role="tab">Courses</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="server-tab" data-bs-toggle="tab" data-bs-target="#server" type="button" role="tab">Server & Diagnostics</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">Users</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="layout-tab" data-bs-toggle="tab" data-bs-target="#layout" type="button" role="tab">Layout Editor</button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">

            <!-- DASHBOARD TAB -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="row">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="stat-courses">0</div>
                            <div class="stat-label">Courses</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="stat-textbooks">0</div>
                            <div class="stat-label">Textbooks</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="stat-covers">0</div>
                            <div class="stat-label">Covers Found</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="stat-server">--</div>
                            <div class="stat-label">Server Status</div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <h5>Last Import</h5>
                        <p id="last-import-info">No imports yet</p>
                    </div>
                    <div class="col-md-6">
                        <h5>Quick Actions</h5>
                        <div>
                            <button class="btn btn-primary btn-sm" onclick="switchToTab('textbooks')">Manage Textbooks</button>
                            <button class="btn btn-primary btn-sm" onclick="switchToTab('courses')">Manage Courses</button>
                            <button class="btn btn-primary btn-sm" onclick="switchToTab('server')">Server Control</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TEXTBOOKS TAB -->
            <div class="tab-pane fade" id="textbooks" role="tabpanel">
                <div class="mb-4">
                    <h5>Bulk Operations</h5>
                    <div class="btn-group" role="group">
                        <button class="btn btn-success btn-action" onclick="scanTextbooks()">Scan Textbook Library</button>
                        <button class="btn btn-info btn-action" onclick="showCoverSearch()">Search for Covers</button>
                        <button class="btn btn-warning btn-action" onclick="generatePlaceholders()">Generate Placeholders</button>
                    </div>
                </div>

                <div id="textbook-progress" class="progress-log" style="display:none;">
                    <div id="textbook-log"></div>
                </div>

                <div id="cover-search-div" style="display:none;" class="my-4">
                    <h5>Cover Search</h5>
                    <div class="mb-3">
                        <label for="cover-source" class="form-label">Select Source:</label>
                        <select class="form-select" id="cover-source">
                            <option value="google">Google Books (Recommended)</option>
                            <option value="openlibrary">Open Library</option>
                            <option value="archive">Archive.org</option>
                            <option value="bookcovers">BookCovers.io</option>
                        </select>
                    </div>
                    <button class="btn btn-info" onclick="executeSearchCovers()">Search All Missing Covers</button>
                    <button class="btn btn-warning" onclick="cancelSearchCovers()">Cancel</button>
                </div>

                <h5 class="mt-4">Textbooks Library</h5>
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="textbooks-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Author</th>
                                <th>Cover</th>
                                <th>Date Added</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="textbooks-tbody">
                            <tr><td colspan="5" class="text-center text-muted">Click "Scan Textbook Library" to load</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- COURSES TAB -->
            <div class="tab-pane fade" id="courses" role="tabpanel">
                <div class="mb-4">
                    <h5>Bulk Operations</h5>
                    <div class="btn-group" role="group">
                        <button class="btn btn-success btn-action" onclick="scanCourses()">Scan Courses Directory</button>
                        <button class="btn btn-warning btn-action" onclick="generateThumbnails()">Generate Thumbnails</button>
                        <button class="btn btn-info btn-action" onclick="autoCategorize()">Auto-Categorize Courses</button>
                    </div>
                </div>

                <div id="course-progress" class="progress-log" style="display:none;">
                    <div id="course-log"></div>
                </div>

                <h5 class="mt-4">Courses Library</h5>
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="courses-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Thumbnail</th>
                                <th>Categories</th>
                                <th>Date Added</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="courses-tbody">
                            <tr><td colspan="5" class="text-center text-muted">Click "Scan Courses Directory" to load</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- SERVER & DIAGNOSTICS TAB -->
            <div class="tab-pane fade" id="server" role="tabpanel">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h5>Server Status</h5>
                        <div class="stat-card">
                            <p><strong>Status:</strong> <span id="server-status" class="status-badge status-running">Running</span></p>
                            <p><strong>Mode:</strong> <span id="server-mode">--</span></p>
                            <p><strong>Uptime:</strong> <span id="server-uptime">--</span></p>
                            <p><strong>Memory:</strong> <span id="server-memory">--</span></p>
                            <p><strong>CPU:</strong> <span id="server-cpu">--</span></p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>Server Control</h5>
                        <div class="btn-group-vertical w-100" role="group">
                            <button class="btn btn-warning btn-action" onclick="restartServer()">Restart Server</button>
                            <button class="btn btn-info btn-action" onclick="startDevMode()">Start Development Mode</button>
                            <button class="btn btn-primary btn-action" onclick="startProdMode()">Start Production Mode</button>
                            <button class="btn btn-danger btn-action" onclick="stopServer()">Stop Server</button>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h5>System Diagnostics</h5>
                        <button class="btn btn-info mb-3" onclick="runDiagnostics()">Run Diagnostics</button>
                        <div id="diagnostics-output" class="progress-log" style="display:none;">
                            <div id="diagnostics-log"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>Recent Logs</h5>
                        <button class="btn btn-info mb-3" onclick="fetchLogs()">Fetch Latest Logs</button>
                        <div id="logs-output" class="progress-log" style="display:none;">
                            <div id="logs-content"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- USERS TAB -->
            <div class="tab-pane fade" id="users" role="tabpanel">
                <h5>User Management</h5>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Username</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                            <tr>
                                <td>{{ user.id }}</td>
                                <td>{{ user.username }}</td>
                                <td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') if user.created_at else 'N/A' }}</td>
                                <td>
                                    {% if user.username != 'admin' %}
                                        <button class="btn btn-danger btn-sm delete-user-btn" data-user-id="{{ user.id }}" data-username="{{ user.username }}">Delete</button>
                                    {% else %}
                                        <span class="text-muted">Admin (Protected)</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- LAYOUT EDITOR TAB -->
            <div class="tab-pane fade" id="layout" role="tabpanel">
                <h5>Layout Configuration</h5>
                <p class="text-muted">Customize the size and spacing of featured sections</p>

                <form id="layout-form">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Featured Courses Table</h6>
                            <div class="mb-3">
                                <label for="courses-width" class="form-label">Table Width</label>
                                <input type="text" class="form-control" id="courses-width" name="featured_courses_width" placeholder="e.g., 100%, 600px">
                            </div>
                            <div class="mb-3">
                                <label for="courses-max-width" class="form-label">Max Width</label>
                                <input type="text" class="form-control" id="courses-max-width" name="featured_courses_max_width" placeholder="e.g., 600px">
                            </div>
                            <div class="mb-3">
                                <label for="course-img-width" class="form-label">Image Width</label>
                                <input type="text" class="form-control" id="course-img-width" name="course_image_width" placeholder="e.g., 150px">
                            </div>
                            <div class="mb-3">
                                <label for="course-font" class="form-label">Title Font Size</label>
                                <input type="text" class="form-control" id="course-font" name="course_title_font_size" placeholder="e.g., 1rem">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <h6>Featured Ebooks Table</h6>
                            <div class="mb-3">
                                <label for="ebooks-width" class="form-label">Table Width</label>
                                <input type="text" class="form-control" id="ebooks-width" name="featured_ebooks_width" placeholder="e.g., 100%, 600px">
                            </div>
                            <div class="mb-3">
                                <label for="ebooks-max-width" class="form-label">Max Width</label>
                                <input type="text" class="form-control" id="ebooks-max-width" name="featured_ebooks_max_width" placeholder="e.g., 600px">
                            </div>
                            <div class="mb-3">
                                <label for="ebook-img-width" class="form-label">Image Width</label>
                                <input type="text" class="form-control" id="ebook-img-width" name="ebook_image_width" placeholder="e.g., 120px">
                            </div>
                            <div class="mb-3">
                                <label for="ebook-img-height" class="form-label">Image Height</label>
                                <input type="text" class="form-control" id="ebook-img-height" name="ebook_image_height" placeholder="e.g., 150px">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <h6>General Settings</h6>
                            <div class="mb-3">
                                <label for="table-padding" class="form-label">Table Cell Padding</label>
                                <input type="text" class="form-control" id="table-padding" name="table_padding" placeholder="e.g., 12px">
                            </div>
                            <div class="mb-3">
                                <label for="table-gap" class="form-label">Table Gap/Spacing</label>
                                <input type="text" class="form-control" id="table-gap" name="table_gap" placeholder="e.g., 0.75rem">
                            </div>
                            <div class="mb-3">
                                <label for="card-background" class="form-label">Card Background</label>
                                <input type="text" class="form-control" id="card-background" name="card_background" placeholder="e.g., transparent, #ffffff">
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <button type="button" class="btn btn-primary" onclick="saveLayoutSettings()">Save Settings</button>
                        <button type="button" class="btn btn-secondary" onclick="resetLayoutSettings()">Reset to Defaults</button>
                        <button type="button" class="btn btn-info" onclick="previewLayoutSettings()">Preview Changes</button>
                    </div>
                </form>

                <div id="layout-message" class="mt-3"></div>
            </div>

        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/admin.js') }}?v=2"></script>

</body>
</html>
